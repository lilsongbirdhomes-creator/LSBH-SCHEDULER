<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LilSongBirdHomes Scheduler</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="login-wrap">
  <div class="login-head">
    <h1>ğŸµ LilSongBirdHomes</h1>
    <p>Staff Scheduling System</p>
  </div>
  <div class="login-body">
    <div id="loginError" class="err-msg"></div>
    <div class="fg">
      <label>Username</label>
      <input type="text" id="username" placeholder="Enter username" autocomplete="username">
    </div>
    <div class="fg">
      <label>Password</label>
      <input type="password" id="password" placeholder="Enter password" autocomplete="current-password">
    </div>
    <button class="login-btn" onclick="handleLogin()">Sign In</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app" class="app hidden">
  <div class="app-hdr">
    <div>
      <h1>ğŸµ LilSongBirdHomes</h1>
      <div class="sub">Logged in as: <span id="userName"></span></div>
    </div>
    <div class="hdr-right">
      <div class="badge" id="roleBadge">Staff</div>
      <button class="lo-btn" onclick="handleLogout()">Logout</button>
    </div>
  </div>

  <div class="content">
    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
      <div class="admin-tabs">
        <button class="a-tab active" onclick="switchTab('schedule')">Schedule</button>
        <button class="a-tab" onclick="switchTab('staff')">Manage Staff</button>
        <button class="a-tab" onclick="switchTab('approvals')">
          Approvals <span id="approvalBadge" class="approval-badge hidden">0</span>
        </button>
      </div>

      <!-- SCHEDULE TAB -->
      <div id="scheduleTab" class="tab-pane active">
        <!-- Shift Generator Button -->
        <button class="gen-trigger-btn" onclick="openShiftGenerator()">
          ğŸ—“ï¸ Shift Generator
        
        <!-- Notification Button -->
        <div class="notification-section">
          <button id="sendNotificationsBtn" class="btn-notify" onclick="sendScheduleNotifications()" disabled style="opacity:0.5;">
            ğŸ“§ Send Notifications
          </button>
          <button class="btn-clear-changes" onclick="clearScheduleChanges()">
            ğŸ—‘ï¸ Clear Changes
          </button>
        </div>
        </button>
      </div>

      <!-- STAFF MANAGEMENT TAB -->
      <div id="staffTab" class="tab-pane">
        <!-- Data Backup Section -->
        <div class="data-backup-section">
          <h4>ğŸ’¾ Data Backup & Restore</h4>
          <p>Export your data before deploying, then import it back to restore staff and shifts.</p>
          <div class="data-backup-buttons">
            <button class="btn-export" onclick="exportData()">
              ğŸ“¥ Export Data
            </button>
            <button class="btn-import" onclick="openImportDialog()">
              ğŸ“¤ Import Data
            </button>
          </div>
        </div>

        <div class="staff-mgmt">
          <h3>Add New Staff Member</h3>
          <div class="add-form">
            <div class="frow">
              <input type="text" id="newUsername" placeholder="Username">
              <input type="text" id="newFullName" placeholder="Full Name">
              <select id="newJobTitle">
                <option value="Caregiver">Caregiver</option>
                <option value="House Manager">House Manager</option>
                <option value="Trainer">Trainer</option>
                <option value="Admin">Admin</option>
              </select>
              <button class="add-s-btn" onclick="addStaff()">Add Staff</button>
            </div>
          </div>
          <h3>Current Staff</h3>
          <div id="staffList"></div>
        </div>
      </div>

      <!-- APPROVALS TAB -->
      <div id="approvalsTab" class="tab-pane">
        <div class="approvals-section">
          <h3>Pending Approvals</h3>
          <div id="approvalsList"></div>
          <div id="noApprovalsMsg" class="empty-state">
            âœ… No pending approvals
          </div>
        </div>
      </div>
    </div>
      <div class="cal-nav-left">
        <button class="nav-arrow" onclick="navPrev()">â—„</button>
        <span class="cal-title" id="calTitle"></span>
        <button class="nav-arrow" onclick="navNext()">â–º</button>
      </div>
      <div class="view-toggle">
        <button class="v-btn active" id="vWeek" onclick="setView('week')">Week</button>
        <button class="v-btn" id="vMonth" onclick="setView('month')">Month</button>
      </div>
    </div>

    <!-- Calendar Display -->
    <div class="cal-scroll">
      <div id="calendarRoot"></div>
    </div>

    <!-- Staff Dashboard -->
    <div id="staffDashboard" class="hidden">
      <div class="dashboard-card">
        <h3>ğŸ“Š Your Dashboard</h3>
        <div id="dashboardContent"></div>
      </div>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div id="passwordModal" class="ov">
  <div class="modal">
    <h3>ğŸ”’ Change Password</h3>
    <div class="fg">
      <label>New Password (min 6 characters)</label>
      <input type="password" id="newPassword" placeholder="Enter new password">
    </div>
    <div class="mbtn-row">
      <button class="mc" onclick="closePasswordModal()">Cancel</button>
      <button class="mok" onclick="savePassword()">Change Password</button>
    </div>
  </div>
</div>

<!-- Edit Staff Modal -->
<div id="editStaffModal" class="ov">
  <div class="modal">
    <h3>âœï¸ Edit Staff Member</h3>
    <input type="hidden" id="editStaffId">
    <div class="fg">
      <label>Full Name</label>
      <input type="text" id="editFullName">
    </div>
    <div class="fg">
      <label>Job Title</label>
      <select id="editJobTitle">
        <option value="Caregiver">Caregiver</option>
        <option value="Nurse">Nurse</option>
        <option value="House Manager">House Manager</option>
      </select>
    </div>
    <div class="fg">
      <label>Tile Color</label>
      <input type="color" id="editTileColor">
    </div>
    <div class="fg">
      <label>Text Color</label>
      <select id="editTextColor">
        <option value="black">Black</option>
        <option value="white">White</option>
      </select>
    </div>
    <div class="fg">
      <label>Telegram ID (for notifications)</label>
      <input type="text" id="editTelegramId" placeholder="Leave blank if not linked">
    </div>
    <div class="mbtn-row">
      <button class="mc" onclick="closeEditStaffModal()">Cancel</button>
      <button class="mok" onclick="saveStaffEdit()">Save Changes</button>
    </div>
  </div>
</div>

<!-- Loading Indicator -->
<div id="loading" class="loading-overlay hidden">
  <div class="spinner"></div>
</div>


<!-- Shift Generator Modal -->
<div id="shiftGeneratorModal" class="modal-overlay" style="display:none;">
  <div class="modal-content shift-gen-modal">
    <h3>ğŸ—“ï¸ Shift Generator</h3>
    
    <!-- Tab Selection -->
    <div class="gen-tabs">
      <button class="gen-tab active" onclick="switchGenTab('create')">Create Shifts</button>
      <button class="gen-tab" onclick="switchGenTab('copy')">Copy Shifts</button>
      <button class="gen-tab" onclick="switchGenTab('templates')">Edit Templates</button>
    </div>
    
    <!-- CREATE SHIFTS TAB -->
    <div id="genTabCreate" class="gen-tab-content active">
      <h4>Create New Shifts</h4>
      
      <div class="gen-section">
        <label>Date Range:</label>
        <div class="date-range">
          <input type="date" id="genStartDate" class="inp">
          <span>to</span>
          <input type="date" id="genEndDate" class="inp">
        </div>
      </div>
      
      <div class="gen-section">
        <label>Which Days:</label>
        <div class="day-checkboxes">
          <label><input type="checkbox" id="daySun" checked> Sun</label>
          <label><input type="checkbox" id="dayMon" checked> Mon</label>
          <label><input type="checkbox" id="dayTue" checked> Tue</label>
          <label><input type="checkbox" id="dayWed" checked> Wed</label>
          <label><input type="checkbox" id="dayThu" checked> Thu</label>
          <label><input type="checkbox" id="dayFri" checked> Fri</label>
          <label><input type="checkbox" id="daySat" checked> Sat</label>
        </div>
      </div>
      
      <div class="gen-section">
        <label>Which Shift Types:</label>
        <div class="shift-checkboxes">
          <label><input type="checkbox" id="shiftMorning" checked> ğŸŒ… Morning</label>
          <label><input type="checkbox" id="shiftAfternoon" checked> ğŸŒ† Afternoon</label>
          <label><input type="checkbox" id="shiftOvernight" checked> ğŸŒ™ Overnight</label>
        </div>
      </div>
      
      <div class="gen-section">
        <label>Assignment Pattern:</label>
        <select id="genPattern" class="inp" onchange="togglePatternOptions()">
          <option value="open">Leave as Open Shifts</option>
          <option value="specific">Assign to Specific Staff</option>
          <option value="rotate">Rotate Through Staff</option>
        </select>
        
        <div id="specificStaffOption" class="pattern-option" style="display:none;">
          <label>Assign all to:</label>
          <select id="genSpecificStaff" class="inp">
            <option value="">-- Select Staff --</option>
          </select>
        </div>
        
        <div id="rotateStaffOption" class="pattern-option" style="display:none;">
          <label>Rotation Order (drag to reorder):</label>
          <div id="rotationList" class="rotation-list"></div>
        </div>
      </div>
      
      <div class="gen-preview">
        <strong>Preview:</strong> <span id="genPreviewText">Select options above</span>
      </div>
      
      <div class="modal-actions">
        <button class="b-can" onclick="closeShiftGenerator()">Cancel</button>
        <button class="b-pri" onclick="generateShifts()">Generate Shifts</button>
      </div>
    </div>
    
    <!-- COPY SHIFTS TAB -->
    <div id="genTabCopy" class="gen-tab-content">
      <h4>Copy Existing Shifts</h4>
      
      <div class="gen-section">
        <label>Copy From:</label>
        <div class="copy-from-options">
          <label><input type="radio" name="copyFrom" value="day" checked> Single Day</label>
          <label><input type="radio" name="copyFrom" value="week"> Full Week</label>
          <label><input type="radio" name="copyFrom" value="month"> Full Month</label>
        </div>
        <input type="date" id="copySourceDate" class="inp">
      </div>
      
      <div class="gen-section">
        <label>Copy To:</label>
        <input type="date" id="copyTargetDate" class="inp">
        <small>Shifts will be copied starting from this date</small>
      </div>
      
      <div class="gen-section">
        <label>Options:</label>
        <label><input type="checkbox" id="copyKeepAssignments" checked> Keep staff assignments</label>
        <label><input type="checkbox" id="copySkipExisting" checked> Skip if shift already exists</label>
      </div>
      
      <div class="gen-preview">
        <strong>Preview:</strong> <span id="copyPreviewText">Select dates above</span>
      </div>
      
      <div class="modal-actions">
        <button class="b-can" onclick="closeShiftGenerator()">Cancel</button>
        <button class="b-pri" onclick="copyShifts()">Copy Shifts</button>
      </div>
    </div>
    
    <!-- EDIT TEMPLATES TAB -->
    <div id="genTabTemplates" class="gen-tab-content">
      <h4>Edit Shift Templates</h4>
      
      <div class="template-editor">
        <div class="template-item">
          <h5>ğŸŒ… Morning Shift</h5>
          <label>Label:</label>
          <input type="text" id="tmplMorningLabel" class="inp" value="Morning">
          <label>Time:</label>
          <input type="text" id="tmplMorningTime" class="inp" value="7:00 AM â€“ 3:00 PM">
          <label>Hours:</label>
          <input type="number" id="tmplMorningHours" class="inp" value="8.0" step="0.5">
        </div>
        
        <div class="template-item">
          <h5>ğŸŒ† Afternoon Shift</h5>
          <label>Label:</label>
          <input type="text" id="tmplAfternoonLabel" class="inp" value="Afternoon">
          <label>Time:</label>
          <input type="text" id="tmplAfternoonTime" class="inp" value="3:00 PM â€“ 7:00 PM">
          <label>Hours:</label>
          <input type="number" id="tmplAfternoonHours" class="inp" value="4.0" step="0.5">
        </div>
        
        <div class="template-item">
          <h5>ğŸŒ™ Overnight Shift</h5>
          <label>Label:</label>
          <input type="text" id="tmplOvernightLabel" class="inp" value="Overnight">
          <label>Time:</label>
          <input type="text" id="tmplOvernightTime" class="inp" value="7:00 PM â€“ 7:00 AM">
          <label>Hours:</label>
          <input type="number" id="tmplOvernightHours" class="inp" value="12.0" step="0.5">
        </div>
      </div>
      
      <p class="template-note">âš ï¸ Note: Templates are saved locally in your browser. They don't sync across devices.</p>
      
      <div class="modal-actions">
        <button class="b-can" onclick="closeShiftGenerator()">Cancel</button>
        <button class="b-pri" onclick="saveTemplates()">Save Templates</button>
      </div>
    </div>
    
  </div>
</div>


<script src="/app.js"></script>
<!-- ADD THIS TO index.html BEFORE </body> -->

<!-- Import Data Modal -->
<div id="importDataModal" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <h3>ğŸ“¤ Import Data from Backup</h3>
    
    <div class="import-instructions">
      <p>Select a backup file (JSON) to restore staff and shifts.</p>
      <p><strong>This will:</strong></p>
      <ul>
        <li>âœ… Add missing staff members</li>
        <li>âœ… Add missing shifts</li>
        <li>âœ… Restore shift templates</li>
        <li>âš ï¸ Skip existing data (no duplicates)</li>
      </ul>
    </div>
    
    <input type="file" id="importFileInput" accept=".json" onchange="handleImportFileSelect(event)">
    
    <div id="importPreview"></div>
    
    <div class="modal-actions">
      <button class="b-can" onclick="closeImportDialog()">Cancel</button>
      <button class="b-pri" id="importButton" onclick="confirmImport()" disabled>Import Data</button>
    </div>
  </div>
</div>

</body>
</html>
